import torch

print('1.æ ‡é‡ä¸å˜é‡') # æ ‡é‡ç”±åªæœ‰ä¸€ä¸ªå…ƒç´ çš„å¼ é‡è¡¨ç¤º
x = torch.tensor([3.0])
y = torch.tensor([2.0])
print(x + y, x * y, x / y, x ** y)

x = torch.arange(4) # å¯ä»¥å°†å‘é‡è§†ä¸ºæ ‡é‡å€¼ç»„æˆçš„åˆ—è¡¨
print('2.å‘é‡')
print('x:', x)
print('x[3]:', x[3])  # é€šè¿‡å¼ é‡çš„ç´¢å¼•æ¥è®¿é—®ä»»ä¸€å…ƒç´ 
print('å¼ é‡çš„å½¢çŠ¶:', x.shape)  # å¼ é‡çš„å½¢çŠ¶
print('å¼ é‡çš„é•¿åº¦:', len(x))  # å¼ é‡çš„é•¿åº¦
z = torch.arange(24).reshape(2, 3, 4)
print('ä¸‰ç»´å¼ é‡çš„é•¿åº¦:', len(z))

print('3.çŸ©é˜µ')
A = torch.arange(20).reshape(5, 4)
print('A:', A)
print('A.shape:', A.shape)
print('A.shape[-1]:', A.shape[-1]) #A.shape[-1] è¡¨ç¤ºè®¿é—® A å½¢çŠ¶ä¸­çš„æœ€åä¸€ä¸ªç»´åº¦çš„å¤§å°
print('A.T:', A.T)  # çŸ©é˜µçš„è½¬ç½®

print('4.çŸ©é˜µçš„è®¡ç®—')
A = torch.arange(20, dtype=torch.float32).reshape(5, 4)
B = A.clone()  # é€šè¿‡åˆ†é…æ–°å†…å­˜ï¼Œå°†Açš„ä¸€ä¸ªå‰¯æœ¬åˆ†é…ç»™B
print('A:', A)
print('B:', B)
print('A + B:', A + B)  # çŸ©é˜µç›¸åŠ 
print('A * B:', A * B)  # çŸ©é˜µç›¸ä¹˜

a = 2
X = torch.arange(24).reshape(2, 3, 4) #* è¿™é‡Œçš„ (2, 3, 4) è¡¨ç¤ºå¼ é‡æœ‰ 2 ä¸ªçŸ©é˜µï¼ˆæˆ– "batch"ï¼‰ï¼Œæ¯ä¸ªçŸ©é˜µæœ‰ 3 è¡Œå’Œ 4 åˆ—ã€‚
print('X:', X)
print('a + X:', a + X)  # çŸ©é˜µçš„å€¼åŠ ä¸Šæ ‡é‡
print('a * X:', a * X)
print((a * X).shape)

print('5.çŸ©é˜µçš„sumè¿ç®—')
print('A:', A)
print('A.shape:', A.shape)
print('A.sum():', A.sum()) #A.sum(): å¯¹å¼ é‡ A ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œ
print('A.sum(axis=0):', A.sum(axis=0))  
# A.sum(axis=0): æ²¿ç€ç¬¬ 0 è½´ï¼ˆå³æ²¿ç€è¡Œæ–¹å‘ï¼‰å¯¹ A è¿›è¡Œæ±‚å’Œï¼Œè¿™ä¼šç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º (4,) çš„å‘é‡ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ A ä¸­å¯¹åº”åˆ—çš„å’Œã€‚
# ç»“æœ: [0+4+8+12+16, 1+5+9+13+17, 2+6+10+14+18, 3+7+11+15+19]
print('A.sum(axis=1):', A.sum(axis=1))  
# A.sum(axis=1): æ²¿ç€ç¬¬ 1 è½´ï¼ˆå³æ²¿ç€åˆ—æ–¹å‘ï¼‰å¯¹ A è¿›è¡Œæ±‚å’Œï¼Œè¿™ä¼šç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º (5,) çš„å‘é‡ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ A ä¸­å¯¹åº”è¡Œçš„å’Œã€‚
# ç»“æœ: [0+1+2+3, 4+5+6+7, 8+9+10+11, 12+13+14+15, 16+17+18+19]
print('A.sum(axis=1, keepdims=True)', A.sum(axis=1, keepdims=True))  
# A.sum(axis=1, keepdims=True): æ²¿ç¬¬ 1 è½´è¿›è¡Œæ±‚å’Œï¼ŒåŒæ—¶ä½¿ç”¨ keepdims=True ä¿æŒåŸæœ‰çš„ç»´åº¦æ•°é‡ã€‚è¿™æ„å‘³ç€ç»“æœå°†æ˜¯ä¸€ä¸ªå¤§å°ä¸º (5, 1) çš„å¼ é‡ï¼Œè€Œä¸æ˜¯ (5,)ã€‚
# é€šè¿‡å¹¿æ’­æœºåˆ¶ï¼ŒA.sum(axis=1, keepdims=True) ä¿æŒäº†åŸå§‹å¼ é‡çš„å½¢çŠ¶ï¼Œä½¿å¾—å¯ä»¥ä¸å…¶ä»–å¼ é‡ï¼ˆå¦‚åŸå§‹å¼ é‡ Aï¼‰è¿›è¡Œå…ƒç´ çº§åˆ«çš„æ“ä½œã€‚å¹¿æ’­åœ¨æ“ä½œå¤šç»´å¼ é‡æ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ä¿æŒæˆ–æ‰©å±•ç»´åº¦ä»¥è¿›è¡Œè®¡ç®—æ—¶ã€‚
print('A.sum(axis=[0, 1]):', A.sum(axis=[0, 1]))  
# Same as `A.sum()`
# A.sum(axis=[0, 1]): æ²¿ç¬¬ 0 è½´å’Œç¬¬ 1 è½´è¿›è¡Œæ±‚å’Œï¼Œç›¸å½“äºå¯¹æ•´ä¸ªå¼ é‡ A ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œã€‚è¿™å’Œç›´æ¥è°ƒç”¨ A.sum() çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚
print('A.mean():', A.mean())
print('A.sum() / A.numel():', A.sum() / A.numel())
print('A.cumsum(axis=0):', A.cumsum(axis=0)) 
# axis=0 è¡¨ç¤ºæ²¿ç€ç¬¬ 0 è½´ï¼ˆè¡Œæ–¹å‘ï¼‰è¿›è¡Œç´¯ç§¯æ€»å’Œã€‚è¿™æ„å‘³ç€ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯è¯¥åˆ—å½“å‰è¡Œå’Œå‰é¢æ‰€æœ‰è¡Œçš„ç´¯ç§¯å’Œã€‚
""" å‡è®¾ A æ˜¯å¦‚ä¸‹çš„å¼ é‡ï¼š
tensor([[ 0.,  1.,  2.,  3.],
        [ 4.,  5.,  6.,  7.],
        [ 8.,  9., 10., 11.],
        [12., 13., 14., 15.],
        [16., 17., 18., 19.]])
è®¡ç®— A.cumsum(axis=0) çš„ç»“æœä¸ºï¼š
tensor([[ 0.,  1.,  2.,  3.],
        [ 4.,  6.,  8., 10.],
        [12., 15., 18., 21.],
        [24., 28., 32., 36.],
        [40., 45., 50., 55.]])
ç¬¬ä¸€è¡Œä¿æŒä¸å˜ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‰é¢çš„è¡Œã€‚
ç¬¬äºŒè¡Œä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œç›¸åº”å…ƒç´ çš„ç´¯ç§¯å’Œï¼Œä¾‹å¦‚ï¼š4 = 0 + 4, 6 = 1 + 5 ç­‰ã€‚
ç¬¬ä¸‰è¡Œä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ç¬¬ä¸€è¡Œã€ç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œç›¸åº”å…ƒç´ çš„ç´¯ç§¯å’Œï¼Œä¾æ­¤ç±»æ¨ã€‚
 """
print('6.å‘é‡-å‘é‡ç›¸ä¹˜ï¼ˆç‚¹ç§¯ï¼‰')
x = torch.arange(4, dtype=torch.float32)
y = torch.ones(4, dtype=torch.float32)
print('x:', x)
print('y:', y)
print('å‘é‡-å‘é‡ç‚¹ç§¯:', torch.dot(x, y))

# 7. çŸ©é˜µ-å‘é‡ç›¸ä¹˜ (çŸ©é˜µä¹˜ä»¥ä¸€ä¸ªå‘é‡)
print('7.çŸ©é˜µ-å‘é‡ç›¸ä¹˜(å‘é‡ç§¯)')
A = torch.arange(20, dtype=torch.float32).reshape(5, 4)  # åˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º (5, 4) çš„å¼ é‡
x = torch.arange(4, dtype=torch.float32).reshape(4, 1)   # åˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º (4, 1) çš„å¼ é‡ï¼ˆå‘é‡ï¼‰
print('A:', A)  # è¾“å‡ºçŸ©é˜µ A (5*4)
print('x:', x)  # è¾“å‡ºå‘é‡ x (4*1)
print('torch.mv(A, x):', torch.mv(A, x))  # å°†çŸ©é˜µ A ä¸å‘é‡ x ç›¸ä¹˜ï¼Œç»“æœæ˜¯ä¸€ä¸ª (5, 1) çš„å¼ é‡
# çŸ©é˜µ-å‘é‡ç›¸ä¹˜ï¼štorch.mv(A, x) æ‰§è¡ŒçŸ©é˜µ A å’Œå‘é‡ x çš„ä¹˜æ³•è¿ç®—ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªå‘é‡ã€‚

# 8. çŸ©é˜µ-çŸ©é˜µç›¸ä¹˜ (ä¸¤ä¸ªçŸ©é˜µç›¸ä¹˜)
print('8.çŸ©é˜µ-çŸ©é˜µç›¸ä¹˜(çŸ©é˜µç§¯)')
B = torch.ones(4, 3)  # åˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º (4, 3) çš„å…¨ 1 çŸ©é˜µ
print('A:', A)  # è¾“å‡ºçŸ©é˜µ A (5*4)
print('B:', B)  # è¾“å‡ºçŸ©é˜µ B (4*3)
print('torch.mm(A, B):', torch.mm(A, B))  # å°†çŸ©é˜µ A ä¸çŸ©é˜µ B ç›¸ä¹˜ï¼Œç»“æœæ˜¯ä¸€ä¸ª (5, 3) çš„å¼ é‡
# çŸ©é˜µ-çŸ©é˜µç›¸ä¹˜ï¼štorch.mm(A, B) æ‰§è¡ŒçŸ©é˜µ A å’ŒçŸ©é˜µ B çš„ä¹˜æ³•è¿ç®—ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªçŸ©é˜µã€‚

# 9. èŒƒæ•° (å‘é‡å’ŒçŸ©é˜µçš„èŒƒæ•°)
print('9.èŒƒæ•°')
u = torch.tensor([3.0, -4.0])  # åˆ›å»ºä¸€ä¸ªäºŒç»´å‘é‡ u
print('å‘é‡çš„ğ¿2èŒƒæ•°:', torch.norm(u))  
# è®¡ç®—å‘é‡ u çš„ ğ¿2 èŒƒæ•°ï¼Œå³ Euclidean èŒƒæ•°ï¼ˆâˆš(3^2 + (-4)^2) = 5ï¼‰
print('å‘é‡çš„ğ¿1èŒƒæ•°:', torch.abs(u).sum())  
# è®¡ç®—å‘é‡ u çš„ ğ¿1 èŒƒæ•°ï¼Œå³æ‰€æœ‰å…ƒç´ ç»å¯¹å€¼çš„å’Œ (3 + 4 = 7)

v = torch.ones((4, 9))  # åˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º (4, 9) çš„å…¨ 1 çŸ©é˜µ
print('v:', v)  # è¾“å‡ºçŸ©é˜µ v
print('çŸ©é˜µçš„ğ¿2èŒƒæ•°:', torch.norm(v))  
# è®¡ç®—çŸ©é˜µ v çš„ #!(ğ¿2 èŒƒæ•°ï¼Œå³æ‰€æœ‰å…ƒç´ å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹)

# 10. æ ¹æ®ç´¢å¼•è®¿é—®çŸ©é˜µ
print('10.æ ¹æ®ç´¢å¼•è®¿é—®çŸ©é˜µ')
y = torch.arange(10).reshape(5, 2)  # åˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º (5, 2) çš„å¼ é‡
print('y:', y)  # è¾“å‡ºçŸ©é˜µ y
index = torch.tensor([1, 4])  # æŒ‡å®šä¸€ä¸ªç´¢å¼•åˆ—è¡¨
print('y[index]:', y[index])  
# æ ¹æ®ç´¢å¼•è®¿é—®çŸ©é˜µ y çš„è¡Œ (å–å‡ºç¬¬ 1 è¡Œå’Œç¬¬ 4 è¡Œ)

# 11. ç†è§£ PyTorch ä¸­çš„ gather() å‡½æ•°
print('11.ç†è§£pytorchä¸­çš„gather()å‡½æ•°')
a = torch.arange(15).view(3, 5)  # åˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º (3, 5) çš„å¼ é‡
print('11.1äºŒç»´çŸ©é˜µä¸Šgather()å‡½æ•°')
print('a:', a)  # è¾“å‡ºçŸ©é˜µ a
b = torch.zeros_like(a)  # åˆ›å»ºä¸€ä¸ªä¸ a å½¢çŠ¶ç›¸åŒçš„å…¨é›¶çŸ©é˜µ
b[1][2] = 1  # ç»™çŸ©é˜µ b çš„ (1, 2) å…ƒç´ èµ‹å€¼ä¸º 1
b[0][0] = 1  # ç»™çŸ©é˜µ b çš„ (0, 0) å…ƒç´ èµ‹å€¼ä¸º 1
print('b:', b)  # è¾“å‡ºçŸ©é˜µ b

# ä½¿ç”¨ gather() å‡½æ•°åœ¨ç¬¬ 0 ç»´å’Œç¬¬ 1 ç»´ä¸Šæ”¶é›†å…ƒç´ 
c = a.gather(0, b)  # æŒ‰ç…§ b çš„å€¼ï¼Œä» a çš„ç¬¬ 0 ç»´åº¦æ”¶é›†å…ƒç´ 
d = a.gather(1, b)  # æŒ‰ç…§ b çš„å€¼ï¼Œä» a çš„ç¬¬ 1 ç»´åº¦æ”¶é›†å…ƒç´ 
print('d:', d)  # è¾“å‡º d

print('11.2ä¸‰ç»´çŸ©é˜µä¸Šgather()å‡½æ•°')
a = torch.randint(0, 30, (2, 3, 5))  # åˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º (2, 3, 5) çš„éšæœºæ•´æ•°å¼ é‡
print('a:', a)  # è¾“å‡ºä¸‰ç»´å¼ é‡ a

index = torch.LongTensor([[[0, 1, 2, 0, 2],
                           [0, 0, 0, 0, 0],
                           [1, 1, 1, 1, 1]],
                          [[1, 2, 2, 2, 2],
                           [0, 0, 0, 0, 0],
                           [2, 2, 2, 2, 2]]])  # æŒ‡å®šä¸€ä¸ªå½¢çŠ¶ä¸º (2, 3, 5) çš„ç´¢å¼•å¼ é‡
print(a.size() == index.size())  # æ£€æŸ¥ a çš„å°ºå¯¸æ˜¯å¦ä¸ index ç›¸åŒ (åº”ä¸º True)

b = torch.gather(a, 1, index)  # åœ¨ç¬¬ 1 ç»´ä¸ŠæŒ‰ç…§ index æ”¶é›† a çš„å…ƒç´ 
print('b:', b)  # è¾“å‡º b
c = torch.gather(a, 2, index)  # åœ¨ç¬¬ 2 ç»´ä¸ŠæŒ‰ç…§ index æ”¶é›† a çš„å…ƒç´ 
print('c:', c)  # è¾“å‡º c

index2 = torch.LongTensor([[[0, 1, 1, 0, 1],
                            [0, 1, 1, 1, 1],
                            [1, 1, 1, 1, 1]],
                           [[1, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0],
                            [1, 1, 0, 0, 0]]])  # å¦ä¸€ä¸ªç´¢å¼•å¼ é‡

d = torch.gather(a, 0, index2)  # åœ¨ç¬¬ 0 ç»´ä¸ŠæŒ‰ç…§ index2 æ”¶é›† a çš„å…ƒç´ 
print('d:', d)  # è¾“å‡º d

# 12. ç†è§£ PyTorch ä¸­çš„ max() å’Œ argmax() å‡½æ•°
print('12.ç†è§£pytorchä¸­çš„max()å’Œargmax()å‡½æ•°')
a = torch.tensor([[1, 2, 3], [3, 2, 1]])  # åˆ›å»ºä¸€ä¸ª 2*3 çš„å¼ é‡
b = a.argmax(1)  # è¿”å›æ¯ä¸€è¡Œä¸­æœ€å¤§å…ƒç´ çš„ç´¢å¼• (axis=1, è¡Œ)
c = a.max(1)  # è¿”å›æ¯ä¸€è¡Œçš„æœ€å¤§å…ƒç´ åŠå…¶ç´¢å¼•
d = a.max(1)[1]  # ä»…è¿”å›æ¯ä¸€è¡Œçš„æœ€å¤§å…ƒç´ çš„ç´¢å¼•

print('a:', a)  # è¾“å‡º a
print('a.argmax(1):', b)  # è¾“å‡º b: [2, 0]ï¼Œè¡¨ç¤ºæ¯ä¸€è¡Œæœ€å¤§å€¼çš„ç´¢å¼•
print('a.max(1):', c)  # è¾“å‡º c: åŒ…å«æœ€å¤§å€¼åŠå…¶ç´¢å¼•çš„å…ƒç»„
print('a.max(1)[1]:', d)  # è¾“å‡º d: ä»…ç´¢å¼•

# 13. item() å‡½æ•°
print('13.item()å‡½æ•°')
a = torch.Tensor([1, 2, 3])  # åˆ›å»ºä¸€ä¸ª 1*3 çš„æµ®ç‚¹æ•°å¼ é‡
print('a[0]:', a[0])  # ç›´æ¥é€šè¿‡ç´¢å¼•è®¿é—® a çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›çš„æ˜¯ tensor å¯¹è±¡
print('a[0].item():', a[0].item())  # ä½¿ç”¨ item() æ–¹æ³•è·å–çº¯ Python æ•°å€¼ (1.0)
